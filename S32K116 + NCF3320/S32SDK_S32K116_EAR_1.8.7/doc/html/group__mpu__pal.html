<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>S32 SDK: Memory Protection Unit Peripheral Abstraction Layer (MPU PAL)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top" style="height:auto; width:100%"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <img id="projectlogo" style="height:auto; width:100%" alt="Logo" src="s32sdk_logo_small.jpg"/>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__mpu__pal.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Memory Protection Unit Peripheral Abstraction Layer (MPU PAL)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The S32 SDK provides a Peripheral Abstraction Layer for Memory Protection Unit (MPU) modules of S32 SDK devices. </p>
<p>The MPU PAL driver provides memory protection functionality via allocate regions and restrict access rights of all masters on the region. It was designed to be portable across all platforms and IPs which support Memory Protection Unit. </p>
<h2>How to integrate MPU PAL in your application</h2>
<p>Unlike the other drivers, MPU PAL modules need to include a configuration file named mpu_pal_cfg.h, which allows the user to specify which IPs are used and how many resources are allocated for each of them (state structures). The following code example shows how to configure one instance for each available MPU IPs. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef MPU_PAL_CFG_H</span></div>
<div class="line"><span class="preprocessor">#define MPU_PAL_CFG_H</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Define which IP instance will be used in current project (only one of them)*/</span></div>
<div class="line"><span class="preprocessor">#define MPU_OVER_MPU</span></div>
<div class="line"><span class="preprocessor">#define MPU_OVER_SMPU</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* MPU_PAL_CFG_H */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p>The following tables contains IPs specification on platforms:</p><ul>
<li>Available <table class="doxtable">
<tr>
<th align="center">IP/MCU </th><th align="center">S32K116</th><th align="center">S32K142</th><th align="center">S32K144</th><th align="center">S32K146</th><th align="center">S32K148</th><th align="center">S32MTV</th><th align="center">MPC5744P</th><th align="center">MPC5746C</th><th align="center">MPC5748G  </th></tr>
<tr>
<td align="center">MPU </td><td align="center">YES </td><td align="center">YES </td><td align="center">YES </td><td align="center">YES </td><td align="center">YES </td><td align="center">YES </td><td align="center">NO </td><td align="center">NO </td><td align="center">NO </td></tr>
<tr>
<td align="center">SMPU </td><td align="center">NO </td><td align="center">NO </td><td align="center">NO </td><td align="center">NO </td><td align="center">NO </td><td align="center">NO </td><td align="center">YES </td><td align="center">YES </td><td align="center">YES </td></tr>
</table>
</li>
<li>Number of supported instances <table class="doxtable">
<tr>
<th align="center">IP/MCU </th><th align="center">S32K116</th><th align="center">S32K142</th><th align="center">S32K144</th><th align="center">S32K146</th><th align="center">S32K148</th><th align="center">S32MTV</th><th align="center">MPC5744P</th><th align="center">MPC5746C</th><th align="center">MPC5748G  </th></tr>
<tr>
<td align="center">MPU </td><td align="center">1 </td><td align="center">1 </td><td align="center">1 </td><td align="center">1 </td><td align="center">1 </td><td align="center">1 </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td></tr>
<tr>
<td align="center">SMPU </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">1 </td><td align="center">1 </td><td align="center">2 </td></tr>
</table>
</li>
<li>Number of supported regions <table class="doxtable">
<tr>
<th align="center">IP/MCU </th><th align="center">S32K116</th><th align="center">S32K142</th><th align="center">S32K144</th><th align="center">S32K146</th><th align="center">S32K148</th><th align="center">S32MTV</th><th align="center">MPC5744P</th><th align="center">MPC5746C</th><th align="center">MPC5748G  </th></tr>
<tr>
<td align="center">MPU </td><td align="center">8 </td><td align="center">8 </td><td align="center">8 </td><td align="center">8 </td><td align="center">16 </td><td align="center">8 </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td></tr>
<tr>
<td align="center">SMPU </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">&ndash; </td><td align="center">16 </td><td align="center">16 </td><td align="center">16 </td></tr>
</table>
<h2>Initialization &amp; De-initialization</h2>
</li>
</ul>
<ul>
<li>In order to use the MPU PAL driver it must be first initialized, using <a class="el" href="group__mpu__pal__code.html#ga7acf2f736152851559e84c59212c4257" title="Initializes memory protection unit by allocating regions and granting access rights for masters...">MPU_Init()</a> function to initialize or re-initialize module.</li>
<li>Example:</li>
</ul>
<ol type="1">
<li>Definitions for MPU IP (MPU_OVER_MPU) <div class="fragment"><div class="line"><span class="comment">/* Define MPU PAL instance */</span></div>
<div class="line"><span class="preprocessor">#define INST_MPU_PAL          MPU_OVER_MPU0_INSTANCE  </span><span class="comment">/* MPU instance 0 */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Define number of masters supported by platform */</span></div>
<div class="line"><span class="preprocessor">#define MPU_PAL_MASTER_COUNT  (16U)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Define number of used regions (should be in range supported by platform) */</span></div>
<div class="line"><span class="preprocessor">#define MPU_PAL_REGION_COUNT  (1U)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Status variable */</span></div>
<div class="line"><a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> status;</div>
</div><!-- fragment --></li>
<li>Region configuration <div class="fragment"><div class="line"><span class="comment">/* Master configuration */</span></div>
<div class="line"><a class="code" href="structmpu__master__privilege__right__t.html">mpu_master_privilege_right_t</a> mpu_pal_masterAccRight[MPU_PAL_MASTER_COUNT] =</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Master */</span></div>
<div class="line">  {</div>
<div class="line">    .<a class="code" href="structmpu__master__privilege__right__t.html#a5b2a9bfc01e67dce9869d4aab51f09bc">masterNum</a> = <a class="code" href="_s32_k116__features_8h.html#abc066c304f4ba961145af9c683f68cb8">FEATURE_MPU_MASTER_CORE</a>,              <span class="comment">/* Core */</span></div>
<div class="line">    .accessRight = MPU_ACCESS_SUPERVISOR_RWX_USER_RWX  <span class="comment">/* Access right: read, write and execute</span></div>
<div class="line"><span class="comment">                                                       for both supervisor and user mode */</span></div>
<div class="line">  },</div>
<div class="line">  <span class="comment">/* Define the rest masters here */</span></div>
<div class="line">  ...</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Region configuration */</span></div>
<div class="line"><a class="code" href="structmpu__region__config__t.html">mpu_region_config_t</a> mpu_pal_regionConfigs[MPU_PAL_REGION_COUNT] =</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Region 0 */</span></div>
<div class="line">  {</div>
<div class="line">    .<a class="code" href="structmpu__region__config__t.html#a6e74b15307b46f7cbd6f2fa0ad12a653">startAddr</a> = 0U,                           <span class="comment">/* Start address */</span></div>
<div class="line">    .endAddr = 0xFFFFFFFFU,                    <span class="comment">/* End address */</span></div>
<div class="line">    .masterAccRight = mpu_pal_masterAccRight,  <span class="comment">/* Pointer to access right of all masters */</span></div>
<div class="line">  <span class="comment">/* If support PID */</span></div>
<div class="line">    .processIdEnable = 0x01U,                <span class="comment">/* 8&#39;b00000001 Enable PID for logical master 0 (Core) */</span></div>
<div class="line">    .processIdentifier = 0x00U,              <span class="comment">/* Process identifier */</span></div>
<div class="line">    .processIdMask = 0xFFU,                  <span class="comment">/* Process identifier mask */</span></div>
<div class="line">  <span class="comment">/* End if */</span></div>
<div class="line">  <span class="comment">/* Extension */</span></div>
<div class="line">    .extension = NULL                        <span class="comment">/* This field will be used to add extra settings</span></div>
<div class="line"><span class="comment">                                             to the basic region configuration */</span></div>
<div class="line">  <span class="comment">/* End extension */</span></div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --> Or using MPU_GetDefaultConfig() <div class="fragment"><div class="line"><span class="comment">/* Master configuration */</span></div>
<div class="line"><a class="code" href="structmpu__master__privilege__right__t.html">mpu_master_privilege_right_t</a> mpu_pal_masterAccRight[MPU_PAL_MASTER_COUNT];</div>
<div class="line"><span class="comment">/* Region configuration */</span></div>
<div class="line"><a class="code" href="structmpu__region__config__t.html">mpu_region_config_t</a> regionConfig0;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Get default region configuration */</span></div>
<div class="line">MPU_GetDefaultConfig(mpu_pal_masterAccRight, &amp;regionConfig0);</div>
<div class="line"><a class="code" href="structmpu__region__config__t.html">mpu_region_config_t</a> mpu_pal_regionConfigs[MPU_PAL_REGION_COUNT] =</div>
<div class="line">{</div>
<div class="line">  regionConfig0</div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>Initialization <div class="fragment"><div class="line"><span class="comment">/* Initializes MPU PAL */</span></div>
<div class="line">status = <a class="code" href="group__mpu__pal__code.html#ga7acf2f736152851559e84c59212c4257">MPU_Init</a>(INST_MPU_PAL, MPU_PAL_REGION_COUNT, mpu_pal_regionConfigs);</div>
</div><!-- fragment --></li>
<li>De-initialization <div class="fragment"><div class="line"><span class="comment">/* De-initializes MPU PAL */</span></div>
<div class="line">status = <a class="code" href="group__mpu__pal__code.html#gaa4fc29faff44420d836e8f5063f14c6a">MPU_Deinit</a>(INST_MPU_PAL);</div>
</div><!-- fragment --> </li>
</ol>
<h2>Updates region configuration</h2>
<ul>
<li>The MPU PAL driver provides a function named <a class="el" href="group__mpu__pal__code.html#ga6f8f51e1397715fb2eaf6efa8c257408" title="Updates region configuration. ">MPU_UpdateRegion()</a> to update a region configuration (address, access rights of all masters, process identifier,...).</li>
<li>In order to remove unused region or add again, <a class="el" href="group__mpu__pal__code.html#ga85bac5872ab4da39c677595d575d2d29" title="Enables or disables an exist region configuration. ">MPU_EnableRegion()</a> can be used.</li>
<li>Please note the region will be unlocked if the update succeed.</li>
<li>Example:</li>
</ul>
<ol type="1">
<li>Modify (or add new) region after initialization <div class="fragment"><div class="line"><span class="comment">/* Disables process identifier functionality on region 0 */</span></div>
<div class="line">regionConfig0.<a class="code" href="structmpu__region__config__t.html#a0e5244b2eadb53c49b589463e88fa387">processIdEnable</a> = 0x00U;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Updates region 0 */</span></div>
<div class="line">status = <a class="code" href="group__mpu__pal__code.html#ga6f8f51e1397715fb2eaf6efa8c257408">MPU_UpdateRegion</a>(INST_MPU_PAL, 0U, &amp;regionConfig0);</div>
</div><!-- fragment --></li>
<li>Enables/Disables an exist region configuration <div class="fragment"><div class="line"><span class="comment">/* Enables region 1 */</span></div>
<div class="line">status = <a class="code" href="group__mpu__pal__code.html#ga85bac5872ab4da39c677595d575d2d29">MPU_EnableRegion</a>(INST_MPU_PAL, 1U, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Disables region 2 */</span></div>
<div class="line">status = <a class="code" href="group__mpu__pal__code.html#ga85bac5872ab4da39c677595d575d2d29">MPU_EnableRegion</a>(INST_MPU_PAL, 2U, <span class="keyword">false</span>);</div>
</div><!-- fragment --> </li>
</ol>
<h2>Detects access protection errors</h2>
<ul>
<li>The MPU PAL driver provides a function named <a class="el" href="group__mpu__pal__code.html#ga6e2edb0494fc08f663a56287f8429ef6" title="Checks and gets the access error detail information then clear error flag if the error caused by a ma...">MPU_GetError()</a> to detect an access protection error on error capture channel. The channel can be different among IPs.</li>
<li>Example: <div class="fragment"><div class="line"><span class="comment">/* Define error variable */</span></div>
<div class="line"><a class="code" href="structmpu__error__info__t.html">mpu_error_info_t</a> mpu_pal_errVal;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Gets information on channel 0 */</span></div>
<div class="line"><span class="keywordtype">bool</span> errStatus = <a class="code" href="group__mpu__pal__code.html#ga6e2edb0494fc08f663a56287f8429ef6">MPU_GetError</a>(INST_MPU_PAL, 0U, &amp;mpu_pal_errVal)</div>
</div><!-- fragment --> </li>
</ul>
<h2>Other IP specific details</h2>
<ul>
<li><b>MPU</b> (<a href="../html/group__mpu.html">MPU_OVER_MPU</a>)<ul>
<li>Support PID for specific masters corresponding with the processIdEnable bit index.</li>
<li>Detects an access error on slave ports: <table class="doxtable">
<tr>
<th align="center">Source </th><th align="center">Slave port </th><th align="center">Destination </th><th align="center">S32K116</th><th align="center">S32K142</th><th align="center">S32K144</th><th align="center">S32K146</th><th align="center">S32K148</th><th align="center">S32MTV  </th></tr>
<tr>
<td align="center">Crossbar slave port 0 </td><td align="center">0 </td><td align="center">Flash Controller </td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td></tr>
<tr>
<td align="center">Crossbar slave port 1 </td><td align="center">1 </td><td align="center">SRAM backdoor </td><td align="center">x(1) </td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td></tr>
<tr>
<td align="center">Code Bus </td><td align="center">2 </td><td align="center">SRAM_L frontdoor </td><td align="center"></td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td></tr>
<tr>
<td align="center">System Bus </td><td align="center">3 </td><td align="center">SRAM_U frontdoor </td><td align="center"></td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td><td align="center">x </td></tr>
<tr>
<td align="center">Crossbar slave port 2 </td><td align="center">4 </td><td align="center">QuadSPI </td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">x </td><td align="center"></td></tr>
</table>
<em>1: Destination: SRAM controller/MTB/DWT/MCM</em></li>
</ul>
</li>
<li><b>SMPU</b> (<a href="../html/group__smpu.html">MPU_OVER_SMPU</a>)<ul>
<li>Support PID for for all specific masters (processIdEnable same as bool)</li>
<li>Detects an access error on bus masters.</li>
<li>Supports lock and cache inhibit features in region extension.<ul>
<li>An address range specified in an MPU region descriptor for a cacheable space (that is, CI = 0) must be defined with a starting address aligned on a 0-modulo-32 byte address and with a multiple of the 32 byte cache line size factoring into the end address.</li>
</ul>
</li>
<li>MPU_UpdateRegionLock() can be used to update lock configuration on a region.</li>
<li>MPU_GetRegionLockInfo() can be used to get lock status on a region.</li>
<li>Example:</li>
</ul>
<ol type="1">
<li>Extension <div class="fragment"><div class="line"><span class="comment">/* SMPU region extension */</span></div>
<div class="line">mpu_over_smpu_extension mpu_pal_extension =</div>
<div class="line">{</div>
<div class="line">  .cacheInhibitEnable = <span class="keyword">true</span>,  <span class="comment">/* The region cannot be cached */</span></div>
<div class="line">  .lockConfig = MPU_UNLOCK     <span class="comment">/* The region is unlocked */</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Add region 0 extension */</span></div>
<div class="line">mpu_pal_regionConfigs[0U].<a class="code" href="structmpu__region__config__t.html#a562778d1f98fd4d11769f6eb9afe309d">extension</a> = &amp;mpu_pal_extension;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Initialization */</span></div>
<div class="line">...</div>
</div><!-- fragment --></li>
<li>Update lock configuration and get lock status on region <div class="fragment"><div class="line"><span class="comment">/* All masters cannot write to region descriptor 0 (cannot modify region 0 configuration) */</span></div>
<div class="line">status = MPU_UpdateRegionLock(INST_MPU_PAL, 0U, MPU_ALL_LOCK);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Gets lock status on region 0 */</span></div>
<div class="line">mpu_region_lock_t lockStatus;</div>
<div class="line">MPU_GetRegionLockInfo(INST_MPU_PAL, 0U, &amp;lockStatus);</div>
</div><!-- fragment --> </li>
</ol>
</li>
</ul>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__mpu__pal__code"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__mpu__pal__code.html">MPU PAL</a></td></tr>
<tr class="memdesc:group__mpu__pal__code"><td class="mdescLeft">&#160;</td><td class="mdescRight">Memory Protection Unit Peripheral Abstraction Layer. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 8 2018 15:07:06 for S32 SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
