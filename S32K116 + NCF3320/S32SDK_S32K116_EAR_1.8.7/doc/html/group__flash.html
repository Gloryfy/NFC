<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>S32 SDK: Flash Memory (Flash)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top" style="height:auto; width:100%"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <img id="projectlogo" style="height:auto; width:100%" alt="Logo" src="s32sdk_logo_small.jpg"/>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__flash.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Flash Memory (Flash)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Flash Memory Module provides the general flash APIs. </p>
<p>Flash memory is ideal for single-supply applications, permitting in-the-field erase and reprogramming operations without the need for any external high voltage power sources. The flash module includes a memory controller that executes commands to modify flash memory contents. An erased bit reads '1' and a programmed bit reads '0'. The programming operation is unidirectional; it can only move bits from the '1' state (erased) to the '0' state (programmed). Only the erase operation restores bits from '0' to '1'; bits cannot be programmed from a '0' to a '1'.</p>
<h2>C90TFS Flash Driver</h2>
<p>The C90TFS flash module includes the following accessible memory regions.</p><ol type="1">
<li>Program flash memory for vector space and code store.</li>
<li>FlexNVM for data store, additional code store and also non-volatile storage for the EEPROM filing system representing data written to the FlexRAM requiring highest endurance.</li>
<li>FlexRAM for high-endurance EEPROM data store or traditional RAM.</li>
</ol>
<p>Some platforms may be designed to have only program flash memory or all of them.</p>
<p>The S32 SDK provides the C90TFS Flash driver of S32K platforms. The driver includes general APIs to handle specific operations on C90TFS Flash module. The user can use those APIs directly in the application.</p>
<h2>EEPROM feature</h2>
<p>For platforms with FlexNVM, the flash module provides a built-in hardware emulation scheme to emulate the characteristics of an EEPROM by effectively providing a high-endurance, byte write-able NVM. The EEPROM system is shown in the following figure. <a class="anchor" id="figure1"></a> </p><div class="image">
<img src="flash_EEPROM_architecture.jpg" alt="flash_EEPROM_architecture.jpg"/>
</div>
 <center><em>Figure 1. EEPROM Architecture</em></center><p> To handle with various customer's requirements, the FlexRAM and FlexNVM blocks can be split into partitions:</p><ol type="1">
<li>EEPROM partition(EEESIZE) — The amount of FlexRAM used for EEPROM can be set from 0 Bytes (no EEPROM) to the maximum FlexRAM size. The remainder of the FlexRAM not used for EEPROM is not accessible while the FlexRAM is configured for EEPROM.The EEPROM partition grows upward from the bottom of the FlexRAM address space.</li>
<li>Data flash partition(DEPART) — The amount of FlexNVM memory used for data flash can be programmed from 0 bytes (all of the FlexNVM block is available for EEPROM backup) to the maximum size of the FlexNVM block.</li>
<li>FlexNVM EEPROM partition — The amount of FlexNVM memory used for EEPROM backup, which is equal to the FlexNVM block size minus the data flash memory partition size. The EEPROM backup size must be at least 16 times the EEPROM partition size in FlexRAM.</li>
</ol>
<p>The partition information (EEESIZE, DEPART) is programmed using the <b><a class="el" href="group__flash__driver.html#ga95e584380fee0f4d828ba464236f0552" title="Flash D/E-Flash Partition. ">FLASH_DRV_DEFlashPartition</a></b> API.</p>
<p>The function of FlexRAM can be changed from EEPROM usage to traditional RAM for accelerate programming in <b><a class="el" href="group__flash__driver.html#gaaf1ff003b41f3e8f27e9de17ea2564ee" title="Flash program section. ">FLASH_DRV_ProgramSection</a></b> API and vice versa by <b><a class="el" href="group__flash__driver.html#ga813904ddeb7ae798cf90d003d08ae68c" title="Set FlexRAM function. ">FLASH_DRV_SetFlexRamFunction</a></b> API.</p>
<p>This is example code of EEE usage sequence:</p>
<div class="fragment"><div class="line">    <span class="comment">/* Provide information about the flash blocks. */</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structflash__user__config__t.html">flash_user_config_t</a> flashUserConfig =</div>
<div class="line">    {</div>
<div class="line">        0x00000000u,                                <span class="comment">/* Base address of Program Flash block */</span></div>
<div class="line">        <a class="code" href="_s32_k116__features_8h.html#a47687eb42c36d4bc32c613a90fa631bf">FEATURE_FLS_PF_BLOCK_SIZE</a>,                  <span class="comment">/* Size of Program Flash block */</span></div>
<div class="line">        <a class="code" href="_s32_k116__features_8h.html#ab9b535cbe3a4898e7e25e5c2ef984752">FEATURE_FLS_DF_START_ADDRESS</a>,               <span class="comment">/* Base address of Data Flash block */</span></div>
<div class="line">        <a class="code" href="_s32_k116__features_8h.html#a6adf8b56e488c178b1b7f092a36d5d57">FEATURE_FLS_FLEX_RAM_START_ADDRESS</a>,         <span class="comment">/* Base address of FlexRAM block */</span></div>
<div class="line">        <a class="code" href="group__flash__driver.html#ga89226a98a8ca4b5946e0805b84855b8e">NULL_CALLBACK</a>                               <span class="comment">/* Pointer to callback function */</span></div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Declare a FLASH configuration structure which is initialized by FlashInit, and will be used by all flash APIs */</span></div>
<div class="line">    <a class="code" href="structflash__ssd__config__t.html">flash_ssd_config_t</a> flashSSDConfig;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Always initialize the driver before calling other functions */</span></div>
<div class="line">    ret = <a class="code" href="group__flash__driver.html#gab3e8ba3789a93c4b9574ae4d1beaffc6">FLASH_DRV_Init</a>(&amp;flashUserConfig, &amp;flashSSDConfig);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != <a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586a83da0606125c0dc2fe0544cb2c383cb9">STATUS_SUCCESS</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if ((FEATURE_FLS_HAS_FLEX_NVM == 1u) &amp; (FEATURE_FLS_HAS_FLEX_RAM == 1u))</span></div>
<div class="line">    <span class="comment">/* Configure FlexRAM as EEPROM if it is currently used as traditional RAM */</span></div>
<div class="line">    <span class="keywordflow">if</span> (flashSSDConfig.<a class="code" href="group__flash__driver.html#ga545f7cccbd0dc0439639303835cfb00b">EEESize</a> == 0u)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Configure FlexRAM as EEPROM and FlexNVM as EEPROM backup region,</span></div>
<div class="line"><span class="comment">           DEFlashPartition will be failed if the IFR region isn&#39;t blank.</span></div>
<div class="line"><span class="comment">           Refer to the device document for valid EEPROM Data Size Code</span></div>
<div class="line"><span class="comment">           and FlexNVM Partition Code. For example on S32K144:</span></div>
<div class="line"><span class="comment">           - EEEDataSizeCode = 0x02u: EEPROM size = 4 Kbytes</span></div>
<div class="line"><span class="comment">           - DEPartitionCode = 0x08u: EEPROM backup size = 64 Kbytes */</span></div>
<div class="line">        ret = <a class="code" href="group__flash__driver.html#ga95e584380fee0f4d828ba464236f0552">FLASH_DRV_DEFlashPartition</a>(&amp;flashSSDConfig, 0x02u, 0x08u, 0x0, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != <a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586a83da0606125c0dc2fe0544cb2c383cb9">STATUS_SUCCESS</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Re-initialize the driver to update the new EEPROM configuration */</span></div>
<div class="line">            ret = <a class="code" href="group__flash__driver.html#gab3e8ba3789a93c4b9574ae4d1beaffc6">FLASH_DRV_Init</a>(&amp;flashUserConfig, &amp;flashSSDConfig);</div>
<div class="line">            <span class="keywordflow">if</span> (ret != <a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586a83da0606125c0dc2fe0544cb2c383cb9">STATUS_SUCCESS</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> ret;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Make FlexRAM available for EEPROM */</span></div>
<div class="line">            ret = <a class="code" href="group__flash__driver.html#ga813904ddeb7ae798cf90d003d08ae68c">FLASH_DRV_SetFlexRamFunction</a>(&amp;flashSSDConfig, <a class="code" href="group__flash__driver.html#gga391fd17f2b83ad96701b163e8cefe8bdab7c1abc258618e4bd09aa01591949d2c">EEE_ENABLE</a>, 0x0u, NULL);</div>
<div class="line">            <span class="keywordflow">if</span> (ret != <a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586a83da0606125c0dc2fe0544cb2c383cb9">STATUS_SUCCESS</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> ret;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span>    <span class="comment">/* FLexRAM is already configured as EEPROM */</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Make FlexRAM available for EEPROM, make sure that FlexNVM and FlexRAM</span></div>
<div class="line"><span class="comment">           are already partitioned successfully before */</span></div>
<div class="line">        ret = <a class="code" href="group__flash__driver.html#ga813904ddeb7ae798cf90d003d08ae68c">FLASH_DRV_SetFlexRamFunction</a>(&amp;flashSSDConfig, <a class="code" href="group__flash__driver.html#gga391fd17f2b83ad96701b163e8cefe8bdab7c1abc258618e4bd09aa01591949d2c">EEE_ENABLE</a>, 0x0u, NULL);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != <a class="code" href="status_8h.html#af9bff8ff1154a04a899276af806b8586a83da0606125c0dc2fe0544cb2c383cb9">STATUS_SUCCESS</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2>Important Note</h2>
<ol type="1">
<li>If using callback in the application, any code reachable from this function must not be placed in a Flash block targeted for a program/erase operation to avoid the RWW error. Functions can be placed in RAM section by using the START/END_FUNCTION_DEFINITION/DECLARATION_RAMSECTION macros.</li>
<li>To suspend the sector erase operation for a simple method, invoke the <b><a class="el" href="group__flash__driver.html#ga8f30196ee275e393393f2488d5718717" title="Flash erase suspend. ">FLASH_DRV_EraseSuspend</a></b> function within callback of <b><a class="el" href="group__flash__driver.html#ga3e2e7c947946983e49824e81bf84b94f" title="Flash erase sector. ">FLASH_DRV_EraseSector</a></b>. In this case, the <b><a class="el" href="group__flash__driver.html#ga8f30196ee275e393393f2488d5718717" title="Flash erase suspend. ">FLASH_DRV_EraseSuspend</a></b> must not be placed in the same block in which the Flash erase sector command is going on.</li>
<li><b><a class="el" href="flash__driver_8c.html#a5099ee4861304bb28fb3874183e7414e">FLASH_DRV_CommandSequence</a></b>, <b><a class="el" href="group__flash__driver.html#ga8f30196ee275e393393f2488d5718717" title="Flash erase suspend. ">FLASH_DRV_EraseSuspend</a></b> and <b><a class="el" href="group__flash__driver.html#gaa1df001fa73116622d9a80f58891a125" title="Flash erase resume. ">FLASH_DRV_EraseResume</a></b> should be executed from RAM or different Flash blocks which are targeted for writing to avoid the RWW error. <b><a class="el" href="group__flash__driver.html#ga8f30196ee275e393393f2488d5718717" title="Flash erase suspend. ">FLASH_DRV_EraseSuspend</a></b> and <b><a class="el" href="group__flash__driver.html#gaa1df001fa73116622d9a80f58891a125" title="Flash erase resume. ">FLASH_DRV_EraseResume</a></b> functions should be called in pairs.</li>
<li>To guarantee the correct execution of this driver, the Flash cache in the Flash memory controller module should be disabled before invoking any API.</li>
<li>Partitioning FlexNVM and FlexRAM for EEPROM usage shall be executed only once in the lifetime of the device.</li>
<li>After successfully partitioning FlexNVM and FlexRAM for EEPROM usage, user needs to call <b><a class="el" href="group__flash__driver.html#gab3e8ba3789a93c4b9574ae4d1beaffc6" title="Initializes Flash. ">FLASH_DRV_Init</a></b> to update memory information in global structure.</li>
<li>Can not erase or program flash when MCU is high speed run mode or very low power mode. </li>
</ol>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__flash__driver"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__flash__driver.html">Flash Memory (Flash)</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 8 2018 15:07:05 for S32 SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
